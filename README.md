# njs-auth-jwt
JWT Authentication using NJS (Nginx Javascript)

## Описание

Данный NJS-модуль позволяет на стороне Nginx аутентифицировать входящие запросы на основе Json Web Token (JWT). 

Поддерживаемые алгоритмы шифрования JWT: 
HS256, HS384, HS512, RS256, RS384, RS512, ES256, ES384, ES512.

Токен ожидается только как аргумент "token" в строке запроса.

## Зависимости

- [Nginx](https://nginx.org) с подключенным модулем [NJS](https://nginx.org/en/docs/njs/index.html) (интегрированным или динамическим).

## Пример конфигурации Nginx 
```
# импортируем NJS-модуль
js_import conf.d/njs_auth_jwt.js;


# Shared-зона для кеша ключей (1MB ~ 50+ ключей)
js_shared_dict_zone zone=jwt_keys:1m timeout=3600s;


server {
        
    listen 80;

    # локейшн для валидации токенов

    location /njs-jwt {
        
        # путь к файлу публичного ключа RS/ES или единого ключа HS
        set $jwt_public_key_file "/etc/nginx/conf.d/ec512-public.pem";
        
        # Флаг валидации EXP токена
        set $jwt_validate_exp "yes";
        
        # Локейшн в который переходим в случае успешной валидации токена
        set $jwt_go_to_location "@njs-jwt";
        
        # Вызываем валидатор из подключенного выше модуля
        js_content njs_auth_jwt.jwt_validate;
    
    }


    # локейшн в случае успешной валидации

    location @njs-jwt {
        root /srv/www/htdocs/storage;
        try_files $uri =404;
    }



} # end of server

```

где, необходимо точно указать имена переменных, как показано на примере, т.к. модуль-валидатор работает именно с этими именами:
- **jwt_keys** имя кэш-хранилища Nginx задаваемое директивой js_shared_dict_zone,  (размер и таймаут кэша менять можно).
- **$jwt_public_key_file** - путь к файлу публичного ключа (RS/ES) или секретного ключа (HS).
- **$jwt_validate_exp** - флаг необходимости валидации срока годности токена (EXP). При значении "yes" валидатор проверяет срок годности, при любых других значениях не проверяет, при отсутствии переменной не проверяет.
- **$jwt_go_to_location** - переменная хранит имя т.н. именованного локейшна, в который будет перенаправлен запрос, в случае успешной валидации токена.
- **jwt_validate;** - точка входа в валидатор. Имя основной функции модуля-валидатора.